CREATE DATABASE IF NOT EXISTS finzen;
USE finzen;

-- Users
CREATE TABLE Users (
  idUser INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  email VARCHAR(100) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  isAdmin TINYINT DEFAULT 0
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Categories
CREATE TABLE Categories (
  idCategory INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  type ENUM('income', 'expense') NOT NULL,
  idUser INT UNSIGNED,
  FOREIGN KEY (idUser) REFERENCES Users(idUser) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Transactions
CREATE TABLE Transactions (
  idTransaction INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  idUser INT UNSIGNED NOT NULL,
  type ENUM('income', 'expense') NOT NULL,
  amount DECIMAL(10,2) NOT NULL,
  description VARCHAR(255),
  idCategory INT UNSIGNED,
  date DATE NOT NULL,
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (idUser) REFERENCES Users(idUser) ON DELETE CASCADE,
  FOREIGN KEY (idCategory) REFERENCES Categories(idCategory) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Budgets
CREATE TABLE Budgets (
  idBudget INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  idUser INT UNSIGNED NOT NULL,
  idCategory INT UNSIGNED NOT NULL,
  limitAmount DECIMAL(10,2) NOT NULL,
  month CHAR(7) NOT NULL, -- formato YYYY-MM
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (idUser) REFERENCES Users(idUser) ON DELETE CASCADE,
  FOREIGN KEY (idCategory) REFERENCES Categories(idCategory) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Goals
CREATE TABLE Goals (
  idGoal INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  idUser INT UNSIGNED NOT NULL,
  title VARCHAR(255) NOT NULL,
  targetAmount DECIMAL(10,2) NOT NULL,
  currentAmount DECIMAL(10,2) DEFAULT 0,
  deadline DATE NOT NULL,
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (idUser) REFERENCES Users(idUser) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
